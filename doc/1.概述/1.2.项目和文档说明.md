# **项目和文档说明**

## **项目说明**

* 项目地址：
<https://github.com/larva-lang/larva-lang>

    * *Note*：国内上github有时候不太方便，后面考虑在国内的git也存一份

* 项目目录结构

    * `bench`：一些benchmark的各种语言（包括Larva自身）实现代码，用于性能测试比对

    * `bin`：启动Larva功能的各脚本，如直接执行程序，编译程序等

    * `compiler`：编译器实现，目前用Python2实现

    * `doc`：文档目录，即本文档所在目录，根据章节分子目录和文件，中文编写

    * `lib`：标准库的实现，顺便以私有模块的形式包含了运行时实现
        * `lib/example`：一些示例程序
        * `lib/test`：存放各种和库无关的测试用例

        <br>

        * *Note*：Larva采用固定路径的标准库和用户库管理代码，因此`example`和`test`放置于标准库下
        * *Note*：这个test下是一些和模块无关的测试用例，例如语法等，各个模块自己的测试用例和模块放在一起
        * *Note*：临时性的测试开发一般在`lib/test/tmp`下，名为`tmp`的目录作为临时目录不进入git（在`.gitignore`中指定了相关规则，见下）

    * `.gitignore`文件：按照git规范配置ignore的文件和目录名规则
        1. 忽略环境配置文件，如`.vscode`等
        1. 忽略运行程序等情况下生成的临时文件，如`.pyc`、`.class`等
        1. 忽略以`.tmp`为后缀或名为`tmp`的文件或目录，这些文件或目录用于临时性的工作，如上面所述的`lib/test/tmp`
        1. 忽略Larva安装目录下的`ulib`目录，这个作为默认的用户库路径

    * `LICENSE`文件：本项目采用GPL-3.0

    * `README.md`文件：项目介绍

## **文档说明**

* Larva的文档在项目的doc目录下，文档章节结构采用子目录+文件的方式组织，Markdown格式，用中文编写

* 文档章节
    1. 概述：对整个项目做简单介绍
    2. 使用：介绍如何使用Larva进行开发，以及一些注意事项
    3. 语法：介绍Larva的语法规定
    4. 标准库：介绍lib目录下各库的接口
    5. Native代码开发：介绍如何开发Native代码

    <br>

    * *Note*：以后如果有必要，可补充编译器源码分析以及各种内部机制的实现说明

* 每个章节可根据内容安排为多个子章节（多个子目录或文件），用`.`分隔数字进行，为排序整齐，可能会在号码前加入前导0，
例如‘3.01.代码编码’就等同于‘3.1.代码编码’，在文档描述中通用

* 如果一个文档目录下的文件集合是可能被扩充的，但是又有一些逻辑上属于“附加说明”或“其他文档”的，则其对应的顺序编号可从大写字母开始，
例如‘4.2.A.其他内建元素’在‘4.2.__builtins’章节中用于描述不好分类的很多小的内建元素，需要放在其他特别分类说明的文档之后

* 单个文档文件用Markdown的标题区分小节，必要处会采用分割线

* 文档中的代码如无特殊说明，均为Larva代码，但并不是所有代码都能直接执行，有的只是一些片段，有的是某些词法的罗列，参考上下文比较容易鉴别

    * 有时候我们需要跨文件或跨模块的多个代码段综合起来做说明，也会写在一个代码块中，会用较明显的注释分隔说明

* 文档中会使用斜体的*Note*标注一些注释说明，例如某些语法规则为什么这样制定，可能存在什么问题等，*Note*段落或小节一般在其层级的最后

* 文档内容的组织尽量采用循序渐进的方式，但是完全不做前向引用是不可能的，在前向引用的时候会尽量做说明，读者应该将相关的前后内容对照来阅读，
有些内容可能和多个章节都有涉及，会选择放在较合适的章节然后在其他地方标注引用

* Larva目前的定位是只在\*nix环境工作（见‘2.1.环境需求’的说明），因此文档中关于目录、文件、示例以及说明等都使用\*nix风格，
若以后支持如Windows之类的其他平台，可在具体细节处做类比，无特殊理由文档的各处不会做区分描述

### **词法语法的格式说明**

* 文档中对于词法的格式说明采用正则

    例：整数字面量token的格式：`\d\w*`，即一个数字后跟数字字母下划线

* 语法的格式说明形式

    * 用中文或大写字母单词描述的词表示语法说明中的变量
    * 花括号`{}`括起来并用分隔符`¦`分隔的表示选择其中之一
    * 方括号`[]`括起来的表示可选
    * 元素后跟三点`...`表示重复
    * 其余内容表示固定格式
    * 如果语法中出现`[]{}`四种符号，则尽量采用文字+示例来描述
    * 为清晰起见，语法描述会增加适当空格，但不代表推荐的代码风格

    例：

    全局变量定义语法：`[public] [final] 类型 变量名 [= 初始化表达式][, 变量名 [= 初始化表达式]]...[,];`，用文字描述就是：
    1. 开头指定类型，类型前可选`public`和`final`修饰
    1. 每个变量需提供变量名，可以选择是否初始化
    1. 至少定义一个变量，可连续定义多个，多个定义用逗号分隔
    1. 以分号结尾，最后一个变量后可跟一个逗号

* 函数、类、方法的说明

    在说明函数的时候，一般情况下我们只关注签名而不是实现，因此花括号和其包围的实现代码都会略去，在函数签名上方用注释写出其使用方法，
    如需详细说明则会在代码块后面进行，例如假设我们对函数`f`和`g`做说明，形式类似：
    ```
    //函数f的说明写在这里
    public void f()

    //函数g的说明写在这里
    public void g()
    ```

    类和方法的说明方式也是类似的，只保留类定义中和上下文相关的属性和方法签名，一般都是public属性和方法，例如假设对类`A`进行说明，形式类似：
    ```
    //类A的总体说明写在这里
    public class A
    {
        //方法f的说明写在这里
        public void f()

        //属性n的说明写在这里
        public int n;
    }
    ```

    如果一个类、函数或方法的用处很明显，也可省略说明部分，只留签名，一般都是上文已经介绍过的，或者是固定签名的特殊方法等

    在‘3.11.类’和‘3.12.接口’的说明中将会提到通过usemethod继承方法的机制，在说明存在这些继承情况的类或接口时，
    会视情况将继承的方法签名展开在文档中描述，例如，文档对接口`Throwable`的说明是这样的：
    ```
    public interface Throwable
    {
        /*
        返回异常对象包含的信息，或异常本身的描述
        */
        public String str();
    }
    ```
    而实际实现中，`str`方法是继承自`Stringable`接口：
    ```
    public interface Throwable
    {
        Stringable usemethod;
    }
    ```

    由于Larva不支持多值返回，一般是用`ref`语法来做，因此在函数和方法的参数说明中，某个`ref`参数只用于返回数据，也会直接说明为“返回xxx数据”，
    若其既用于输入又用于输出，则会做详细说明

    Larva推荐对Native代码中实现的Go函数的命名为`lar_go_func_@<<名字>>`，这个规范的说明可参考‘5.Native开发’一章，在文档描述到这些函数时，
    为方便起见可直接使用`名字`，结合上下文可很容易理解，Native全局变量的说明方式也是类似的
    
    * *Note*：Larva的Native代码开发中没有Native类和Native接口的概念，参考‘5.Native开发’
